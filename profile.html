<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hồ sơ cá nhân - RoomStay</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="profile.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="homepage">
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="header-content">
                <!-- Logo -->
                <div class="logo">
                    <a href="home.html">
                        <h1>RoomStay</h1>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="home.html" class="nav-link">Trang chủ</a></li>
                        <li><a href="contact.html" class="nav-link">Liên hệ</a></li>
                        <li><button class="nav-link search-btn" id="searchBtn">
                            <i class="fas fa-search"></i>
                            Tìm kiếm
                        </button></li>
                    </ul>
                </nav>

                <!-- Auth Buttons -->
                <div class="auth-buttons" id="authButtons">
                    <!-- Default state - not logged in -->
                    <div class="auth-buttons-default">
                        <a href="login.html" class="btn btn-outline">Đăng nhập</a>
                        <a href="register.html" class="btn btn-primary">Đăng ký</a>
                    </div>
                    
                    <!-- Logged in state -->
                    <div class="auth-buttons-logged" style="display: none;">
                        <div class="user-info">
                            <span class="user-name" id="userName">Người dùng</span>
                            <div class="user-menu">
                                <button class="user-menu-btn" id="userMenuBtn">
                                    <i class="fas fa-user-circle"></i>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="user-dropdown" id="userDropdown">
                                    <a href="profile.html" class="dropdown-item active">
                                        <i class="fas fa-user"></i>
                                        Tài khoản
                                    </a>
                                    <a href="#" class="dropdown-item" id="logoutBtn">
                                        <i class="fas fa-sign-out-alt"></i>
                                        Đăng xuất
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main profile-main">
        <div class="profile-layout">
            <!-- Sidebar -->
            <aside class="profile-sidebar">
                <div class="sidebar-header">
                    <h2>Quản lý chức năng</h2>
                </div>
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-item active" data-section="profile">
                        <i class="fas fa-user"></i>
                        Hồ sơ cá nhân
                    </a>
                    <a href="#" class="sidebar-item" data-section="rental-history">
                        <i class="fas fa-history"></i>
                        Lịch sử thuê trọ
                    </a>
                    <a href="#" class="sidebar-item" data-section="change-password">
                        <i class="fas fa-key"></i>
                        Đổi mật khẩu
                    </a>
                    <a href="request-status.html" class="sidebar-item">
                        <i class="fas fa-clipboard-list"></i>
                        Trạng thái yêu cầu
                    </a>
                    <a href="messages.html" class="sidebar-item">
                        <i class="fas fa-envelope"></i>
                        Tin nhắn
                    </a>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <div class="profile-content-area">
                <!-- Profile Header -->
                <div class="profile-header-section">
                    <div class="profile-avatar">
                        <div class="avatar-placeholder">
                            <span>Avatar</span>
                        </div>
                    </div>
                    <div class="profile-info">
                        <h1 class="profile-name" id="profileName">Trần Văn Nhân</h1>
                        <p class="profile-email" id="profileEmail">tranvannhan@example.com</p>
                    </div>
                </div>

                <!-- Profile Form -->
                <div class="profile-form-section" id="profile-section">
                    <form class="profile-form" id="personalForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName">Họ và tên</label>
                                <input type="text" id="fullName" name="fullName" value="Trần Văn Nhân">
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" value="tranvannhan@example.com" disabled>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="dateOfBirth">Ngày sinh</label>
                                <input type="text" id="dateOfBirth" name="dateOfBirth" placeholder="dd/mm/yyyy">
                            </div>
                            <div class="form-group">
                                <label for="phone">Số điện thoại</label>
                                <input type="tel" id="phone" name="phone" placeholder="Nhập số điện thoại">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Địa chỉ</label>
                            <input type="text" id="address" name="address" placeholder="Nhập địa chỉ của bạn">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Cập nhật hồ sơ</button>
                        </div>
                    </form>
                </div>

                <!-- Rental History Section -->
                <div class="rental-history-section" id="rental-history">
                    <div class="section-header">
                        <h2>Lịch sử thuê trọ</h2>
                    </div>
                    
                    <div class="rental-cards-container">
                        <!-- Rental Card 1 -->
                        <div class="rental-card">
                            <div class="rental-card-left">
                                <div class="room-number-box">
                                    <span class="room-number">Phòng 1</span>
                                </div>
                            </div>
                            <div class="rental-card-right">
                                <div class="rental-info">
                                    <h3 class="rental-title">Phòng trọ tại Quận 1</h3>
                                    <p class="rental-address">Địa chỉ: 123 Nguyễn Văn Cừ, Quận 1, TP. Hồ Chí Minh</p>
                                    <p class="rental-period">Thời gian thuê: 01/01/2023 - 31/12/2023</p>
                                </div>
                                <div class="rental-status">
                                    <span class="status-badge status-ended">Đã kết thúc</span>
                                </div>
                            </div>
                        </div>

                        <!-- Rental Card 2 -->
                        <div class="rental-card">
                            <div class="rental-card-left">
                                <div class="room-number-box">
                                    <span class="room-number">Phòng 2</span>
                                </div>
                            </div>
                            <div class="rental-card-right">
                                <div class="rental-info">
                                    <h3 class="rental-title">Phòng trọ tại Thủ Đức</h3>
                                    <p class="rental-address">Địa chỉ: 456 Võ Văn Ngân, Thủ Đức, TP. Hồ Chí Minh</p>
                                    <p class="rental-period">Thời gian thuê: 15/05/2024 - Hiện tại</p>
                                </div>
                                <div class="rental-status">
                                    <span class="status-badge status-active">Đang thuê</span>
                                </div>
                            </div>
                        </div>

                        <!-- Rental Card 3 -->
                        <div class="rental-card">
                            <div class="rental-card-left">
                                <div class="room-number-box">
                                    <span class="room-number">Phòng 3</span>
                                </div>
                            </div>
                            <div class="rental-card-right">
                                <div class="rental-info">
                                    <h3 class="rental-title">Phòng trọ tại Bình Thạnh</h3>
                                    <p class="rental-address">Địa chỉ: 789 Điện Biên Phủ, Bình Thạnh, TP. Hồ Chí Minh</p>
                                    <p class="rental-period">Thời gian thuê: 01/03/2022 - 28/02/2023</p>
                                </div>
                                <div class="rental-status">
                                    <span class="status-badge status-ended">Đã kết thúc</span>
                                </div>
                            </div>
                        </div>

                        <!-- Rental Card 4 -->
                        <div class="rental-card">
                            <div class="rental-card-left">
                                <div class="room-number-box">
                                    <span class="room-number">Phòng 4</span>
                                </div>
                            </div>
                            <div class="rental-card-right">
                                <div class="rental-info">
                                    <h3 class="rental-title">Phòng trọ tại Quận 7</h3>
                                    <p class="rental-address">Địa chỉ: 321 Nguyễn Thị Thập, Quận 7, TP. Hồ Chí Minh</p>
                                    <p class="rental-period">Thời gian thuê: 10/08/2024 - Hiện tại</p>
                                </div>
                                <div class="rental-status">
                                    <span class="status-badge status-active">Đang thuê</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Change Password Section -->
                <div class="change-password-section" id="change-password">
                    <div class="password-card">
                        <div class="password-header">
                            <h2>Đổi mật khẩu</h2>
                        </div>
                        <form class="password-form" id="changePasswordForm">
                            <div class="form-group">
                                <label for="currentPassword">Mật khẩu hiện tại</label>
                                <input type="password" id="currentPassword" name="currentPassword" placeholder="Nhập mật khẩu hiện tại" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">Mật khẩu mới</label>
                                <input type="password" id="newPassword" name="newPassword" placeholder="Nhập mật khẩu mới" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
                                <input type="password" id="confirmNewPassword" name="confirmNewPassword" placeholder="Nhập lại mật khẩu mới" required>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Cập nhật mật khẩu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Đổi mật khẩu</h3>
                <button class="modal-close" id="closePasswordModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Mật khẩu hiện tại</label>
                        <input type="password" id="currentPassword" name="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Mật khẩu mới</label>
                        <input type="password" id="newPassword" name="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Xác nhận mật khẩu mới</label>
                        <input type="password" id="confirmNewPassword" name="confirmNewPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="cancelPasswordBtn">Hủy</button>
                        <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Include the same AuthManager class from home.html
        class AuthManager {
            constructor() {
                this.token = localStorage.getItem('authToken');
                this.user = JSON.parse(localStorage.getItem('userInfo') || 'null');
                this.init();
            }

            init() {
                this.updateAuthUI();
                this.bindEvents();
            }

            updateAuthUI() {
                const defaultButtons = document.querySelector('.auth-buttons-default');
                const loggedButtons = document.querySelector('.auth-buttons-logged');
                const userName = document.getElementById('userName');

                if (this.isLoggedIn()) {
                    defaultButtons.style.display = 'none';
                    loggedButtons.style.display = 'flex';
                    
                    if (this.user && this.user.fullName) {
                        userName.textContent = this.user.fullName;
                    } else if (this.user && this.user.email) {
                        // Fallback: sử dụng email nếu không có fullName
                        userName.textContent = this.user.email.split('@')[0];
                    }
                } else {
                    defaultButtons.style.display = 'flex';
                    loggedButtons.style.display = 'none';
                }
            }

            isLoggedIn() {
                return this.token && this.user;
            }

            bindEvents() {
                const userMenuBtn = document.getElementById('userMenuBtn');
                const userDropdown = document.getElementById('userDropdown');

                if (userMenuBtn) {
                    userMenuBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userDropdown.classList.toggle('show');
                    });
                }

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-menu')) {
                        userDropdown.classList.remove('show');
                    }
                });

                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.logout();
                    });
                }
            }

            async logout() {
                try {
                    if (this.token) {
                        await fetch('/api/auth/logout', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                    }
                } catch (error) {
                    console.error('Logout API error:', error);
                } finally {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userInfo');
                    
                    this.token = null;
                    this.user = null;
                    this.updateAuthUI();
                    
                    // Redirect to home page
                    window.location.href = 'home.html';
                }
            }
        }

        // Initialize auth manager
        const authManager = new AuthManager();

        // Check if user is logged in
        if (!authManager.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        // Profile management
        class ProfileManager {
            constructor() {
                this.user = authManager.user;
                this.token = authManager.token;
                this.init();
            }

            init() {
                this.loadUserProfile();
                this.bindEvents();
            }

            loadUserProfile() {
                // Load from localStorage for demo mode
                const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                const pendingRegistration = JSON.parse(localStorage.getItem('pendingRegistration') || '{}');
                
                // Use userInfo first, then fallback to pendingRegistration
                const userData = Object.keys(userInfo).length > 0 ? userInfo : pendingRegistration;
                
                this.displayUserProfile(userData);
            }

            displayUserProfile(userData) {
                // Update header info
                const displayName = userData.fullName || 'Trần Văn Nhân';
                const displayEmail = userData.email || 'tranvannhan@example.com';
                
                document.getElementById('profileName').textContent = displayName;
                document.getElementById('profileEmail').textContent = displayEmail;

                // Update form fields
                document.getElementById('fullName').value = displayName;
                document.getElementById('email').value = displayEmail;
                document.getElementById('phone').value = userData.phone || '';
                document.getElementById('dateOfBirth').value = userData.dateOfBirth || '';
                document.getElementById('address').value = userData.address || '';
            }

            bindEvents() {
                // Form submission
                document.getElementById('personalForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updatePersonalInfo();
                });
            }

            updatePersonalInfo() {
                try {
                    const formData = new FormData(document.getElementById('personalForm'));
                    const updatedData = {
                        fullName: formData.get('fullName'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        dateOfBirth: formData.get('dateOfBirth'),
                        address: formData.get('address')
                    };

                    // Update localStorage
                    const currentUserInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
                    const updatedUserInfo = { ...currentUserInfo, ...updatedData };
                    localStorage.setItem('userInfo', JSON.stringify(updatedUserInfo));

                    // Update pendingRegistration as well
                    const currentPending = JSON.parse(localStorage.getItem('pendingRegistration') || '{}');
                    const updatedPending = { ...currentPending, ...updatedData };
                    localStorage.setItem('pendingRegistration', JSON.stringify(updatedPending));

                    alert('Cập nhật hồ sơ thành công!');
                    
                    // Update display
                    this.displayUserProfile(updatedUserInfo);
                    
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Không thể cập nhật thông tin');
                }
            }
        }

        // Initialize profile manager
        const profileManager = new ProfileManager();

        // Section navigation
        class SectionManager {
            constructor() {
                this.currentSection = 'profile';
                this.init();
            }

            init() {
                this.bindEvents();
                this.showSection('profile'); // Show profile section by default
            }

            bindEvents() {
                const sidebarItems = document.querySelectorAll('.sidebar-item[data-section]');
                
                sidebarItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.getAttribute('data-section');
                        this.showSection(section);
                        this.updateActiveSidebarItem(item);
                    });
                });
            }

            showSection(sectionName) {
                // Hide all sections
                const profileSection = document.getElementById('profile-section');
                const rentalHistorySection = document.getElementById('rental-history');
                const changePasswordSection = document.getElementById('change-password');
                
                // Hide all sections first
                profileSection.style.display = 'none';
                rentalHistorySection.style.display = 'none';
                changePasswordSection.style.display = 'none';
                
                // Show selected section
                if (sectionName === 'profile') {
                    profileSection.style.display = 'block';
                } else if (sectionName === 'rental-history') {
                    rentalHistorySection.style.display = 'block';
                } else if (sectionName === 'change-password') {
                    changePasswordSection.style.display = 'block';
                }
                
                this.currentSection = sectionName;
            }

            updateActiveSidebarItem(activeItem) {
                // Remove active class from all sidebar items
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to clicked item
                activeItem.classList.add('active');
            }
        }

        // Initialize section manager
        const sectionManager = new SectionManager();

        // Password management
        class PasswordManager {
            constructor() {
                this.init();
            }

            init() {
                this.bindEvents();
            }

            bindEvents() {
                const passwordForm = document.getElementById('changePasswordForm');
                if (passwordForm) {
                    passwordForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handlePasswordChange();
                    });
                }

                // Real-time password validation
                const newPasswordInput = document.getElementById('newPassword');
                const confirmPasswordInput = document.getElementById('confirmNewPassword');
                
                if (newPasswordInput) {
                    newPasswordInput.addEventListener('input', () => {
                        this.validatePasswordStrength(newPasswordInput.value);
                    });
                }

                if (confirmPasswordInput) {
                    confirmPasswordInput.addEventListener('input', () => {
                        this.validatePasswordMatch();
                    });
                }
            }

            validatePasswordStrength(password) {
                // Simple password strength validation
                let strength = 'weak';
                if (password.length >= 8 && /[A-Z]/.test(password) && /[0-9]/.test(password)) {
                    strength = 'strong';
                } else if (password.length >= 6) {
                    strength = 'medium';
                }

                // You can add a visual strength indicator here if needed
                return strength;
            }

            validatePasswordMatch() {
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                const confirmInput = document.getElementById('confirmNewPassword');
                
                if (confirmPassword && newPassword !== confirmPassword) {
                    this.showFieldError(confirmInput, 'Mật khẩu xác nhận không khớp');
                    return false;
                } else {
                    this.clearFieldError(confirmInput);
                    return true;
                }
            }

            showFieldError(input, message) {
                const formGroup = input.closest('.form-group');
                formGroup.classList.add('error');
                
                // Remove existing error message
                const existingError = formGroup.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }
                
                // Add new error message
                const errorElement = document.createElement('span');
                errorElement.className = 'error-message';
                errorElement.textContent = message;
                input.parentNode.appendChild(errorElement);
            }

            clearFieldError(input) {
                const formGroup = input.closest('.form-group');
                formGroup.classList.remove('error');
                
                const errorMessage = formGroup.querySelector('.error-message');
                if (errorMessage) {
                    errorMessage.remove();
                }
            }

            handlePasswordChange() {
                const formData = new FormData(document.getElementById('changePasswordForm'));
                const currentPassword = formData.get('currentPassword');
                const newPassword = formData.get('newPassword');
                const confirmPassword = formData.get('confirmNewPassword');

                // Validation
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert('Vui lòng điền đầy đủ thông tin');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('Mật khẩu xác nhận không khớp');
                    return;
                }

                if (newPassword.length < 6) {
                    alert('Mật khẩu mới phải có ít nhất 6 ký tự');
                    return;
                }

                // Simulate API call
                this.updatePassword(currentPassword, newPassword);
            }

            async updatePassword(currentPassword, newPassword) {
                try {
                    // Show loading state
                    const submitBtn = document.querySelector('#changePasswordForm .btn');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Đang cập nhật...';
                    submitBtn.disabled = true;

                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    // For demo purposes, we'll just show success
                    // In real implementation, you would call your API here
                    alert('Đổi mật khẩu thành công!');
                    
                    // Reset form
                    document.getElementById('changePasswordForm').reset();
                    
                    // Reset button
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;

                } catch (error) {
                    console.error('Password update error:', error);
                    alert('Có lỗi xảy ra khi đổi mật khẩu. Vui lòng thử lại.');
                    
                    // Reset button
                    const submitBtn = document.querySelector('#changePasswordForm .btn');
                    submitBtn.textContent = 'Cập nhật mật khẩu';
                    submitBtn.disabled = false;
                }
            }
        }

        // Initialize password manager
        const passwordManager = new PasswordManager();

        // Search functionality (same as home.html)
        class PropertySearch {
            constructor() {
                this.properties = [
                    {
                        id: 1,
                        title: "Phòng Trọ 1",
                        subtitle: "Phòng trọ Quận 1 - Giá tốt",
                        address: "123 Đường Nguyễn Trãi, Quận 1, TP.HCM",
                        price: "3.500.000",
                        rooms: 1,
                        phone: "0912-345-678",
                        district: "Quận 1",
                        priceRange: "3000000-4000000"
                    },
                    {
                        id: 2,
                        title: "Phòng Trọ 2",
                        subtitle: "Căn hộ mini thoáng mát",
                        address: "456 Đường Lê Lợi, Quận 2, TP.HCM",
                        price: "5.000.000",
                        rooms: 1,
                        phone: "0987-654-321",
                        district: "Quận 2",
                        priceRange: "4000000-6000000"
                    },
                    {
                        id: 3,
                        title: "Phòng Trọ 3",
                        subtitle: "Phòng trọ gần đại học",
                        address: "789 Đường 3/2, Quận 10, TP.HCM",
                        price: "2.800.000",
                        rooms: 1,
                        phone: "0901-234-567",
                        district: "Quận 10",
                        priceRange: "2000000-3000000"
                    },
                    {
                        id: 4,
                        title: "Phòng Trọ 4",
                        subtitle: "Phòng trọ đầy đủ tiện nghi",
                        address: "321 Đường Võ Văn Tần, Quận 3, TP.HCM",
                        price: "4.200.000",
                        rooms: 1,
                        phone: "0923-456-789",
                        district: "Quận 3",
                        priceRange: "4000000-5000000"
                    },
                    {
                        id: 5,
                        title: "Phòng Trọ 5",
                        subtitle: "Phòng trọ giá rẻ",
                        address: "654 Đường Cách Mạng Tháng 8, Quận 10, TP.HCM",
                        price: "2.200.000",
                        rooms: 1,
                        phone: "0934-567-890",
                        district: "Quận 10",
                        priceRange: "2000000-3000000"
                    },
                    {
                        id: 6,
                        title: "Phòng Trọ 6",
                        subtitle: "Phòng trọ cao cấp",
                        address: "987 Đường Nguyễn Huệ, Quận 1, TP.HCM",
                        price: "6.500.000",
                        rooms: 1,
                        phone: "0945-678-901",
                        district: "Quận 1",
                        priceRange: "6000000-7000000"
                    }
                ];
                this.init();
            }

            init() {
                this.createSearchModal();
                this.bindEvents();
            }

            createSearchModal() {
                const modal = document.createElement('div');
                modal.className = 'search-modal';
                modal.id = 'searchModal';
                modal.innerHTML = `
                    <div class="search-modal-overlay">
                        <div class="search-modal-content">
                            <div class="search-modal-header">
                                <h3>Tìm kiếm phòng trọ</h3>
                                <button class="search-modal-close" id="closeSearchModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="search-modal-body">
                                <div class="search-filters">
                                    <div class="filter-group">
                                        <label for="searchKeyword">Từ khóa</label>
                                        <input type="text" id="searchKeyword" placeholder="Nhập từ khóa tìm kiếm...">
                                    </div>
                                    <div class="filter-group">
                                        <label for="searchDistrict">Quận/Huyện</label>
                                        <select id="searchDistrict">
                                            <option value="">Tất cả quận</option>
                                            <option value="Quận 1">Quận 1</option>
                                            <option value="Quận 2">Quận 2</option>
                                            <option value="Quận 3">Quận 3</option>
                                            <option value="Quận 10">Quận 10</option>
                                        </select>
                                    </div>
                                    <div class="filter-group">
                                        <label for="searchPrice">Mức giá</label>
                                        <select id="searchPrice">
                                            <option value="">Tất cả mức giá</option>
                                            <option value="2000000-3000000">Dưới 3 triệu</option>
                                            <option value="3000000-4000000">3 - 4 triệu</option>
                                            <option value="4000000-5000000">4 - 5 triệu</option>
                                            <option value="5000000-6000000">5 - 6 triệu</option>
                                            <option value="6000000-7000000">Trên 6 triệu</option>
                                        </select>
                                    </div>
                                    <div class="filter-actions">
                                        <button class="btn btn-outline" id="clearFilters">Xóa bộ lọc</button>
                                        <button class="btn btn-primary" id="searchProperties">Tìm kiếm</button>
                                    </div>
                                </div>
                                <div class="search-results" id="searchResults">
                                    <div class="no-results" style="display: none;">
                                        <i class="fas fa-search"></i>
                                        <p>Không tìm thấy phòng trọ phù hợp</p>
                                    </div>
                                    <div class="results-grid" id="resultsGrid">
                                        <!-- Results will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            bindEvents() {
                // Open search modal
                document.getElementById('searchBtn').addEventListener('click', () => {
                    document.getElementById('searchModal').style.display = 'flex';
                });

                // Close search modal
                document.getElementById('closeSearchModal').addEventListener('click', () => {
                    this.closeModal();
                });

                // Close on overlay click
                document.querySelector('.search-modal-overlay').addEventListener('click', (e) => {
                    if (e.target.classList.contains('search-modal-overlay')) {
                        this.closeModal();
                    }
                });

                // Search functionality
                document.getElementById('searchProperties').addEventListener('click', () => {
                    this.performSearch();
                });

                // Clear filters
                document.getElementById('clearFilters').addEventListener('click', () => {
                    this.clearFilters();
                });

                // Enter key search
                document.getElementById('searchKeyword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });
            }

            closeModal() {
                document.getElementById('searchModal').style.display = 'none';
            }

            performSearch() {
                const keyword = document.getElementById('searchKeyword').value.toLowerCase();
                const district = document.getElementById('searchDistrict').value;
                const priceRange = document.getElementById('searchPrice').value;

                let results = this.properties.filter(property => {
                    let matches = true;

                    // Keyword search
                    if (keyword) {
                        matches = matches && (
                            property.title.toLowerCase().includes(keyword) ||
                            property.subtitle.toLowerCase().includes(keyword) ||
                            property.address.toLowerCase().includes(keyword) ||
                            property.district.toLowerCase().includes(keyword)
                        );
                    }

                    // District filter
                    if (district) {
                        matches = matches && property.district === district;
                    }

                    // Price filter
                    if (priceRange) {
                        matches = matches && property.priceRange === priceRange;
                    }

                    return matches;
                });

                this.displayResults(results);
            }

            displayResults(results) {
                const resultsGrid = document.getElementById('resultsGrid');
                const noResults = document.querySelector('.no-results');

                if (results.length === 0) {
                    resultsGrid.innerHTML = '';
                    noResults.style.display = 'block';
                    return;
                }

                noResults.style.display = 'none';
                resultsGrid.innerHTML = results.map(property => `
                    <div class="result-card">
                        <div class="result-card-header">
                            <h4>${property.title}</h4>
                            <span class="result-price">${property.price} VNĐ/tháng</span>
                        </div>
                        <div class="result-card-body">
                            <p class="result-subtitle">${property.subtitle}</p>
                            <p class="result-address">
                                <i class="fas fa-map-marker-alt"></i>
                                ${property.address}
                            </p>
                            <div class="result-info">
                                <span class="result-district">
                                    <i class="fas fa-building"></i>
                                    ${property.district}
                                </span>
                                <span class="result-phone">
                                    <i class="fas fa-phone"></i>
                                    ${property.phone}
                                </span>
                            </div>
                        </div>
                        <div class="result-card-footer">
                            <button class="btn btn-primary" onclick="alert('Liên hệ: ${property.phone}')">
                                Liên hệ ngay
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            clearFilters() {
                document.getElementById('searchKeyword').value = '';
                document.getElementById('searchDistrict').value = '';
                document.getElementById('searchPrice').value = '';
                document.getElementById('resultsGrid').innerHTML = '';
                document.querySelector('.no-results').style.display = 'none';
            }
        }

        // Initialize search functionality
        const propertySearch = new PropertySearch();

        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const nav = document.querySelector('.nav');
        
        mobileMenuToggle.addEventListener('click', function() {
            nav.classList.toggle('active');
            mobileMenuToggle.classList.toggle('active');
        });

        // Add scroll effect to header
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    </script>
</body>
</html>
